<?xml version="1.0" encoding="UTF-8"?>
<datasource version="1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >
	<meta>
		<id>test-1</id>
		<etl-strategy>replace-source</etl-strategy>
	</meta>
	 
	<patient-table>
        <source xsi:type="plain-file">
            <url>test-1-patients.txt</url>
            <separator>\t</separator>
        </source>
		<idat>
			<patient-id column="patid"/>
			<given-name column="vorname"/>
			<surname column="nachname"/>
			<birthdate format="d.M.u" na="" column="geburtsdatum"/>
			<deathdate format="d.M.u" na="" column="verstorben"/>
			<gender column="geschlecht" na="">
				<map> <!-- maps a column -->
					<case value="W" set-value="female"/>
					<case value="M" set-value="male"/>
					<case value="X" set-value="indeterminate"/>
					<otherwise set-value="" log-warning="Unexpected gender value"/>
				</map>
			</gender>
			<ignore xsi:type="string" column="ignoriert1"/>
			<ignore xsi:type="string" column="patfakt1"/>
		</idat>		
	</patient-table>
	<!-- optional -->
	<visit-table>
        <source xsi:type="plain-file">
		<url>test-1-visits.txt</url>
		<type>text/csv</type>
		<separator>\t</separator>
        </source>
		<idat>
			<patient-id column="patid"/>
			<visit-id column="fallnr"/>
			<start format="d.M.u[ H[:m[:s]]]" na="" truncate-to="year" column="start"/>
			<end format="d.M.u[ H[:m[:s]]]" na="" column="end"/>
		</idat>
		<mdat>
			<!-- in/out code -->
			<concept id="weight">
				<value xsi:type="string" column="gewicht"/>
				<!-- TODO: verify that na values are no allowed for concept start timestamps -->
				<start format="d.M.u[ H[:m[:s]]]" na="" column="start"/>
			</concept>
		</mdat>
	</visit-table>
	
	<wide-table>
        <source xsi:type="plain-file">
            <url>test-1-widetable.txt</url>
			<separator>\t</separator>
        </source>
		<idat>
			<patient-id column="patid"/>
			<visit-id column="fallnr"/>
		</idat>
		<mdat>
			<concept id="natrium">
				<value column="na" xsi:type="decimal"/>
				<start column="zeitpunkt" format="d.M.u[ H[:m[:s]]]"/>
				<unit constant-value="mmol/l" />
				<modifier id="other">
					<value xsi:type="string" na="" constant-value=""/>
				</modifier>
			</concept>
			<concept id="kalium">
				<value column="k" xsi:type="decimal"/>
				<start column="zeitpunkt" format="d.M.u[ H[:m[:s]]]"/>
			</concept>
		</mdat>

	</wide-table>

</datasource>
